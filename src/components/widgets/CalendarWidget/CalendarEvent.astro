---
interface Props {
  title: string
  startTime: string
  endTime: string
  location?: string
  color?: string
  allDay?: boolean
  colorfull?: boolean
}

const {
  title,
  startTime,
  endTime,
  location,
  color = '#3b82f6',
  colorfull = false,
  allDay = false,
} = Astro.props

// Convert hex color to rgba for gradient
const hexToRgba = (hex: string, alpha: number) => {
  const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex)
  return result
    ? `rgba(${parseInt(result[1], 16)}, ${parseInt(result[2], 16)}, ${parseInt(result[3], 16)}, ${alpha})`
    : `rgba(59, 130, 246, ${alpha})`
}

const gradientStyle = (colorfull: boolean) => {
  if (colorfull) {
    return `
      border-left-color: ${color};
      background: linear-gradient(to right, ${hexToRgba(color, 0.3)}, ${hexToRgba(color, 0)});
    `
  }
  return `border-left-color: ${color};`
}
---

<div
  class={`relative pl-4 py-3 backdrop-blur-sm rounded-e-lg border-l-4 overflow-hidden`}
  style={gradientStyle(colorfull)}
>
  <div class="flex items-center gap-2 flex-wrap mb-1">
    <h3
      class={`${allDay ? 'text-sm' : 'text-base'} font-semibold text-base-content break-words`}
    >
      {title}
    </h3>
    {
      allDay && (
        <span class="text-xs px-2 py-0.5 rounded-full bg-primary/20 text-primary font-medium whitespace-nowrap">
          All Day
        </span>
      )
    }
  </div>
  <div class="flex items-center gap-2 text-sm text-base-content/70">
    {
      !allDay && (
        <span>
          {startTime} - {endTime}
        </span>
      )
    }
  </div>
  {
    location && (
      <div class="flex items-center gap-2 text-sm text-base-content/70 mt-1">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-4 w-4"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
          />
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"
          />
        </svg>
        <span class="break-words">{location}</span>
      </div>
    )
  }
</div>
